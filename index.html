<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IRL Life System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0014" />
  <link rel="manifest" href="manifest.json" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root { --glow: #4fc3ff; }
    body { margin:0; font-family:'Orbitron',sans-serif; background:radial-gradient(circle at top,#12001f,#040008); color:#e6e6ff; }
    .container { max-width:430px; margin:30px auto; background:rgba(15,0,30,0.9); border-radius:18px; box-shadow:0 0 30px var(--glow); padding:20px; }
    h1 { text-align:center; color:var(--glow); margin-bottom:8px; }
    .level { text-align:center; font-size:1.1em; margin-bottom:12px; }
    .panel { border:1px solid var(--glow); border-radius:14px; padding:12px; margin-bottom:14px; }
    .stat, .quest { display:flex; justify-content:space-between; margin:6px 0; align-items:center; }
    button { background:linear-gradient(135deg,var(--glow),#ffffff); border:none; border-radius:10px; color:#000; padding:6px 12px; font-family:inherit; cursor:pointer; }
    button:disabled { opacity:0.4; cursor:not-allowed; }
    .system-msg { text-align:center; font-size:0.85em; color:var(--glow); margin-top:10px; }
    .log { max-height:120px; overflow-y:auto; font-size:0.75em; background:rgba(0,0,0,0.4); padding:6px; border-radius:8px; margin-top:10px; }
    .notification { position:fixed; top:20px; right:20px; background:rgba(0,0,0,0.85); color:#fff; padding:12px 18px; border-radius:10px; box-shadow:0 0 20px var(--glow); font-weight:600; display:none; z-index:1000; }
  </style>
</head>
<body>

<div class="container">
  <h1>【 SYSTEM 】</h1>
  <div class="level" id="level"></div>
  <div class="system-msg" id="title"></div>

  <div class="panel">
    <strong>STATS</strong>
    <div class="stat">STR <span id="str"></span></div>
    <div class="stat">END <span id="end"></span></div>
    <div class="stat">AGI <span id="agi"></span></div>
    <div class="stat">INT <span id="int"></span></div>
    <div class="stat">WIL <span id="wil"></span></div>
  </div>

  <div class="panel">
    <strong>DAILY CORE QUESTS</strong>
    <div class="quest">Workout <button id="q-workout" onclick="completeQuest('workout','str')">CLEAR</button></div>
    <div class="quest">Study <button id="q-study" onclick="completeQuest('study','int')">CLEAR</button></div>
    <div class="quest">Meditation <button id="q-meditation" onclick="completeQuest('meditation','wil')">CLEAR</button></div>
  </div>

  <div class="panel">
    <strong>MARTIAL ARTS DRILLS (BONUS)</strong>
    <div class="quest">Kyokushin <button onclick="completeBonus('str')">CLEAR</button></div>
    <div class="quest">Muay Thai <button onclick="completeBonus('end')">CLEAR</button></div>
    <div class="quest">Boxing Footwork <button onclick="completeBonus('agi')">CLEAR</button></div>
    <div class="quest">Wing Chun <button onclick="completeBonus('agi')">CLEAR</button></div>
    <div class="quest">Judo <button onclick="completeBonus('str')">CLEAR</button></div>
    <div class="quest">Jeet Kune Do <button onclick="completeBonus('wil')">CLEAR</button></div>
    <div class="quest">Sword Shadow Practice <button onclick="completeBonus('int')">CLEAR</button></div>
  </div>

  <div class="panel">
    <strong>WEEKLY BOSS</strong>
    <div class="system-msg" id="boss"></div>
    <button onclick="attemptBoss()">ATTEMPT BOSS</button>
  </div>

  <div class="system-msg" id="msg"></div>
  <div class="system-msg" id="streakBox"></div>

  <div class="panel">
    <strong>SKILLS</strong>
    <div class="system-msg" id="skills"></div>
  </div>

  <div class="panel">
    <strong>PENALTY ZONE</strong>
    <div class="system-msg" id="penalty"></div>
  </div>

  <div class="panel">
    <strong>LOG</strong>
    <div class="log" id="history"></div>
  </div>
</div>

<div class="notification" id="notification"></div>

<script>
/* ================= CORE STATE ================= */
var lastBossDate = localStorage.getItem('lastBossDate') || null;
var baseStats = { str:1, end:1, agi:1, int:1, wil:1 };
var level = 1, exp = 0, expMax = 100;
var streak = 0, multiplier = 1;
var bossDefeated = false;
var dailyQuests = { workout:false, study:false, meditation:false };
var lastResetDate = localStorage.getItem('lastResetDate') || null;
var skillFlags = {};
var shadowMonarchUnlocked = false;

/* ================= SAVE / LOAD ================= */
function saveGame(){
  localStorage.setItem('irlSystemSave', JSON.stringify({
    baseStats:baseStats, level:level, exp:exp, expMax:expMax,
    streak:streak, multiplier:multiplier, bossDefeated:bossDefeated,
    dailyQuests:dailyQuests, skillFlags:skillFlags,
    shadowMonarchUnlocked:shadowMonarchUnlocked
  }));
}
function loadGame(){
  var raw = localStorage.getItem('irlSystemSave');
  if(!raw) return;
  var d = JSON.parse(raw);
  baseStats=d.baseStats||baseStats;
  level=d.level||level;
  exp=d.exp||exp;
  expMax=d.expMax||expMax;
  streak=d.streak||streak;
  multiplier=d.multiplier||multiplier;
  bossDefeated=d.bossDefeated||false;
  dailyQuests=d.dailyQuests||dailyQuests;
  skillFlags=d.skillFlags||skillFlags;
  shadowMonarchUnlocked=d.shadowMonarchUnlocked||false;
}
/* ================= WEEKLY BOSS RESET ================= */
function checkWeeklyBossReset(){
  var today = new Date();
  // Week number (ISO week starting Monday)
  var onejan = new Date(today.getFullYear(),0,1);
  var weekNum = Math.ceil((((today - onejan) / 86400000) + onejan.getDay()+1)/7);

  if(lastBossDate != weekNum){
    bossDefeated = false;          // Reset boss
    lastBossDate = weekNum;
    localStorage.setItem('lastBossDate', weekNum);
    notify('Weekly Boss is now available!');
  }
}
/* ================= UTIL ================= */
function notify(t){
  var n=document.getElementById('notification');
  n.innerText=t;
  n.style.display='block';
  setTimeout(function(){ n.style.display='none'; },3500);
  log(t);
}
function log(t){
  document.getElementById('history').innerHTML =
  '['+new Date().toLocaleTimeString()+'] '+t+'<br>' +
  document.getElementById('history').innerHTML;
}
function checkDailyResetByDate(){
  var today = new Date().toDateString();

  if(lastResetDate !== today){
    for(var key in dailyQuests){
      dailyQuests[key] = false;
      var btn = document.getElementById('q-' + key);
      if(btn) btn.disabled = false;
    }

    bossDefeated = false;
    lastResetDate = today;
    localStorage.setItem('lastResetDate', today);

    notify('New day detected. Daily quests reset.');
  }
}
/* ================= GAME LOGIC ================= */
function gainExp(a){
  exp+=Math.floor(a*multiplier);
  while(exp>=expMax){
    exp-=expMax; level++;
    notify('LEVEL UP → '+level);
    if(level>=150 && !shadowMonarchUnlocked){
      shadowMonarchUnlocked=true;
      skillFlags.shadowDominion=true;
      notify('BLACK HEART ACTIVATED. SHADOW MONARCH ASCENSION.');
      multiplier=Math.min(multiplier+0.25,3);
    }
  }
  saveGame(); updateUI();
}

function completeQuest(id, stat){
  if(dailyQuests[id]) return;
  dailyQuests[id]=true;
  document.getElementById('q-'+id).disabled=true;
  baseStats[stat]++; gainExp(20);
}

function completeBonus(stat){
  baseStats[stat]++; gainExp(10);
}

function attemptBoss(){
  var day = new Date().getDay();
  if(day !== 0){ // Boss only available on Sunday
    notify('No Boss Available today.');
    return;
  }
  if(bossDefeated){
    notify('Boss already defeated this week.');
    return;
  }
  if(baseStats.str>=5 && baseStats.end>=5 && baseStats.wil>=5){
    bossDefeated = true;
    gainExp(50);
    notify('BOSS DEFEATED!');
    saveGame();
    updateUI();
  } else {
    notify('Boss Failed. Train More.');
  }
}
/* ================= UI ================= */
function updateUI(){
  document.getElementById('level').innerText='LEVEL '+level+' • EXP '+exp+'/'+expMax;
  document.getElementById('title').innerText=shadowMonarchUnlocked?'SHADOW MONARCH':'HUMAN';
  var s; for(s in baseStats){ document.getElementById(s).innerText=baseStats[s]; }
  document.getElementById('streakBox').innerText='STREAK '+streak+' • x'+multiplier.toFixed(1);
  document.getElementById('skills').innerText=Object.keys(skillFlags).join(' • ')||'None';
}

/* ================= INIT ================= */
loadGame();
checkDailyResetByDate();
checkWeeklyBossReset();
updateUI();
for(var q in dailyQuests){
  if(dailyQuests[q]){
    var b=document.getElementById('q-'+q);
    if(b) b.disabled=true;
  }
}
</script>
</body>

</html>





